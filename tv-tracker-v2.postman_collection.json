{
  "info": {
    "name": "TV-Tracker API v2",
    "_postman_id": "a4c4a6d1-1f8f-4c4a-b6e8-8e4f78b11b1a",
    "description": "Collection Postman pour tester les routes Auth, Users et Movies (v2) avec cas d'erreurs et succ√®s.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "üîê AUTH",
      "item": [
        {
          "name": "Register - Succ√®s",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": "{{base_url}}/api/v2/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test.user@example.com\",\n  \"nom\": \"Test User\",\n  \"username\": \"testuser\",\n  \"password\": \"StrongPass1!\"\n}"
            }
          },
          "response": []
        },
        {
          "name": "Register - Email invalide (regex)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": "{{base_url}}/api/v2/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"bademail\",\n  \"nom\": \"Invalid\",\n  \"username\": \"invalid1\",\n  \"password\": \"StrongPass1!\"\n}"
            }
          }
        },
        {
          "name": "Login - Succ√®s",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": "{{base_url}}/api/v2/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"john.doe@test.com\",\n  \"password\": \"User123!\"\n}"
            }
          }
        },
        {
          "name": "Login - Mauvais mot de passe",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": "{{base_url}}/api/v2/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"john.doe@test.com\",\n  \"password\": \"Wrong123!\"\n}"
            }
          }
        }
      ]
    },
    {
      "name": "üë§ USERS",
      "item": [
        {
          "name": "GET /users/me - Token valide",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{user_token}}" }],
            "url": "{{base_url}}/api/v2/users/me"
          }
        },
        {
          "name": "GET /users/me - Token manquant (401)",
          "request": {
            "method": "GET",
            "url": "{{base_url}}/api/v2/users/me"
          }
        },
        {
          "name": "PATCH /users/me - Mise √† jour username",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{user_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{base_url}}/api/v2/users/me",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"updated_user\"\n}"
            }
          }
        },
        {
          "name": "GET /users/:id - Admin seulement (403 attendu si user)",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{user_token}}" }],
            "url": "{{base_url}}/api/v2/users/671cf1a12a8cbb42cde4a002"
          }
        }
      ]
    },
    {
      "name": "üé¨ MOVIES",
      "item": [
        {
          "name": "GET /movies - Liste filtr√©e (titre + genre)",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{user_token}}" }],
            "url": {
              "raw": "{{base_url}}/api/v2/movies?title=neon&genre=drama",
              "host": ["{{base_url}}"],
              "path": ["api", "v2", "movies"],
              "query": [
                { "key": "title", "value": "neon" },
                { "key": "genre", "value": "drama" }
              ]
            }
          }
        },
        {
          "name": "POST /movies - Cr√©ation admin OK",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{admin_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{base_url}}/api/v2/movies",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Test Movie\",\n  \"genres\": [\"Action\", \"Drama\"],\n  \"synopsis\": \"A test movie.\",\n  \"durationMin\": 100\n}"
            }
          }
        },
        {
          "name": "POST /movies - Acc√®s refus√© (user non admin)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{user_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{base_url}}/api/v2/movies",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"User Movie\",\n  \"genres\": [\"Action\"],\n  \"durationMin\": 100\n}"
            }
          }
        },
        {
          "name": "PATCH /movies/:id - Update (admin)",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{admin_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{base_url}}/api/v2/movies/671cf1a12a8cbb42cde4a101",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Red Horizon (Updated)\",\n  \"durationMin\": 125\n}"
            }
          }
        },
        {
          "name": "DELETE /movies/:id - Mauvais ID (404 attendu)",
          "request": {
            "method": "DELETE",
            "header": [{ "key": "Authorization", "value": "Bearer {{admin_token}}" }],
            "url": "{{base_url}}/api/v2/movies/671cf1a12a8cbb42cde4a999"
          }
        }
      ]
    }
  ],
  "variable": [
    { "key": "base_url", "value": "http://localhost:3000" },
    { "key": "user_token", "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY3MWNmMWExMmE4Y2JiNDJjZGU0YTAwMiIsInJvbGUiOiJ1c2VyIiwidXNlcm5hbWUiOiJqb2huZG9lIiwiaWF0IjoxNzYyMDM2ODA3LCJleHAiOjE3NjIwNDA0MDd9.lroGJ02UytpADX2Wmup31uQ1HVbQY0SwOwiFtBDPGTA" },
    { "key": "admin_token", "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY3MWNmMWExMmE4Y2JiNDJjZGU0YTAwMSIsInJvbGUiOiJhZG1pbiIsInVzZXJuYW1lIjoiYWRtaW4iLCJpYXQiOjE3NjIwMzY4NjgsImV4cCI6MTc2MjA0MDQ2OH0.HQrU0spHMLYkVfGEGUgl8C043Qx5tryiLVBcR3rb_gU" }
  ]
}
